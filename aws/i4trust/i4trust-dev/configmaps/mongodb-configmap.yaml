apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-configmap
  namespace: i4trust-dev
data:
  init-db.sh: |
    export
    mongo -- "$MONGO_INITDB_DATABASE" <<EOF

    var rootUser = '$MONGO_INITDB_ROOT_USERNAME';
    var rootPassword = '$MONGO_INITDB_ROOT_PASSWORD';
    var admin = db.getSiblingDB('admin');
    admin.auth(rootUser, rootPassword);

    use charging_db;
    var passwd = '$(cat "$MONGO_BAE_CHARGING_PW")';
    db.createUser(
    {
      user: 'charging',
      pwd: passwd,
      roles: [
        {
          role: 'readWrite',
          db: 'charging_db'
        }
      ]
    });

    use belp_db;
    var passwd = '$(cat "$MONGO_BAE_BELP_PW")';
    db.createUser(
    {
      user: 'belp',
      pwd: passwd,
      roles: [
        {
          role: 'readWrite',
          db: 'belp_db'
        }
      ]
    });
    EOF
